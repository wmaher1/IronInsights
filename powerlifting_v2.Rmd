---
title: "Final Model"
author: "Melissa Wright"
date: "2024-04-30"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(glmnet)
```

```{r}
pwr <- readRDS("pwrlift.rds") 

training <- pwr %>%
    filter(year == 2023) %>%
    select(!year) %>% 
    drop_na() 

validation <- pwr %>%
    filter(year == 2024) %>%
    select(!year) %>% 
    drop_na()

```

This RDS file contains only data from raw lifters competing in the USAPL federation. Additionally, it only contains relevant variables and removed observations where a lifter failed to complete all three attempts at any of the three lifts.

We will use 2023 data as training data and 2024 data as validation data. There are fewer observations in the validation data set, but it is not too extreme. 


```{r linear}
linear.mdl <- lm(total ~ squat1 + bench1 + pull1 + I(weight*age), training)
summary(linear.mdl)

linear.mdl2 <- lm(total ~ squat1 + bench1 + pull1, training)
summary(linear.mdl2)
```


```{r lasso}
x <- data.matrix(training[,c('squat1', 'bench1', 'pull1')])

y <- training$total

cv_model <- cv.glmnet(x, y, alpha = 1)
best_lambda <- cv_model$lambda.min

final_lasso <- glmnet(x, y, alpha = 1, lambda = best_lambda)
coef(final_lasso)
```


```{r ridge}
x
y

lambda_seq <- 10^seq(2, -2, by = -.1)
ridge_fit <- glmnet(x, y, alpha = 0, lambda = lambda_seq)

ridge_cv <- cv.glmnet(x, y, alpha = 0, lambda = lambda_seq)
best_lambda_ridge <- ridge_cv$lambda.min

best_fit_ridge <- ridge_cv$glmnet.fit
#head(best_fit_ridge)

final_ridge <- glmnet(x, y, alpha = 0, lambda = best_lambda_ridge)
coef(final_ridge)
```

```{r}
pred.linear <- predict(linear.mdl, newdata = validation)
actual <- validation$total

mse.linear <- mean((pred.linear - actual)^2)
mse.linear
```



```{r}
x_test <- data.matrix(validation[,c('squat1', 'bench1', 'pull1')])

pred.lasso <- predict(final_lasso, newx = x_test)
actual <- validation$total

mse.lasso <- mean((pred.lasso - actual)^2)
mse.lasso
```


```{r}
x_test <- data.matrix(validation[,c('squat1', 'bench1', 'pull1')])

pred.ridge <- predict(final_ridge, newx = x_test)
actual <- validation$total

mse.ridge <- mean((pred.ridge - actual)^2)
mse.ridge
```

